# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0

# Tests for Unicode and internationalization support in templates,
# including various scripts, emoji, and special characters.

# Tests basic Unicode support with various scripts and languages.
- name: unicode_basic
  template: |
    Hello, {{name}}!
  tests:
    - desc: handles Chinese characters
      data:
        input: { name: "ä¸–ç•Œ" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, ä¸–ç•Œ!\n" }]

    - desc: handles Japanese characters (Hiragana and Kanji)
      data:
        input: { name: "ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ!\n" }]

    - desc: handles Korean characters (Hangul)
      data:
        input: { name: "ì•ˆë…•í•˜ì„¸ìš”" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, ì•ˆë…•í•˜ì„¸ìš”!\n" }]

    - desc: handles Arabic characters (RTL script)
      data:
        input: { name: "Ù…Ø±Ø­Ø¨Ø§" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, Ù…Ø±Ø­Ø¨Ø§!\n" }]

    - desc: handles Hebrew characters (RTL script)
      data:
        input: { name: "×©×œ×•×" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, ×©×œ×•×!\n" }]

    - desc: handles Cyrillic characters (Russian)
      data:
        input: { name: "ĞœĞ¸Ñ€" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, ĞœĞ¸Ñ€!\n" }]

    - desc: handles Greek characters
      data:
        input: { name: "ÎšÏŒÏƒÎ¼Î¿Ï‚" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, ÎšÏŒÏƒÎ¼Î¿Ï‚!\n" }]

    - desc: handles Thai characters
      data:
        input: { name: "à¸ªà¸§à¸±à¸ªà¸”à¸µ" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à¸ªà¸§à¸±à¸ªà¸”à¸µ!\n" }]

    - desc: handles Hindi/Devanagari characters
      data:
        input: { name: "à¤¨à¤®à¤¸à¥à¤¤à¥‡" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à¤¨à¤®à¤¸à¥à¤¤à¥‡!\n" }]

    - desc: handles Marathi characters (Devanagari script)
      data:
        input: { name: "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°!\n" }]

    - desc: handles Sanskrit characters (Devanagari script)
      data:
        input: { name: "à¤¸à¤‚à¤¸à¥à¤•à¥ƒà¤¤à¤®à¥" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à¤¸à¤‚à¤¸à¥à¤•à¥ƒà¤¤à¤®à¥!\n" }]

    - desc: handles Nepali characters (Devanagari script)
      data:
        input: { name: "à¤¨à¤®à¤¸à¥à¤¤à¥‡" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à¤¨à¤®à¤¸à¥à¤¤à¥‡!\n" }]

    - desc: handles Tamil characters
      data:
        input: { name: "à®µà®£à®•à¯à®•à®®à¯" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à®µà®£à®•à¯à®•à®®à¯!\n" }]

    - desc: handles Telugu characters
      data:
        input: { name: "à°¨à°®à°¸à±à°•à°¾à°°à°‚" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à°¨à°®à°¸à±à°•à°¾à°°à°‚!\n" }]

    - desc: handles Bengali characters
      data:
        input: { name: "à¦¨à¦®à¦¸à§à¦•à¦¾à¦°" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à¦¨à¦®à¦¸à§à¦•à¦¾à¦°!\n" }]

    - desc: handles Gujarati characters
      data:
        input: { name: "àª¨àª®àª¸à«àª¤à«‡" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, àª¨àª®àª¸à«àª¤à«‡!\n" }]

    - desc: handles Kannada characters
      data:
        input: { name: "à²¨à²®à²¸à³à²•à²¾à²°" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à²¨à²®à²¸à³à²•à²¾à²°!\n" }]

    - desc: handles Malayalam characters
      data:
        input: { name: "à´¨à´®à´¸àµà´•à´¾à´°à´‚" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à´¨à´®à´¸àµà´•à´¾à´°à´‚!\n" }]

    - desc: handles Punjabi/Gurmukhi characters
      data:
        input: { name: "à¨¸à¨¤ à¨¸à©à¨°à©€ à¨…à¨•à¨¾à¨²" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à¨¸à¨¤ à¨¸à©à¨°à©€ à¨…à¨•à¨¾à¨²!\n" }]

    - desc: handles Odia characters
      data:
        input: { name: "à¬¨à¬®à¬¸à­à¬•à¬¾à¬°" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, à¬¨à¬®à¬¸à­à¬•à¬¾à¬°!\n" }]

# Tests Indic languages with full sentences.
- name: unicode_indic_sentences
  template: |
    {{message}}
  tests:
    - desc: handles full Hindi sentence
      data:
        input: { message: "à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ à¤¨à¤¾à¤® à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚à¥¤" }
      expect:
        messages:
          - role: user
            content: [{ text: "à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ à¤¨à¤¾à¤® à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚à¥¤\n" }]

    - desc: handles Hindi-English code-mixing (Hinglish)
      data:
        input: { message: "Please à¤…à¤ªà¤¨à¤¾ email address enter à¤•à¤°à¥‡à¤‚à¥¤" }
      expect:
        messages:
          - role: user
            content: [{ text: "Please à¤…à¤ªà¤¨à¤¾ email address enter à¤•à¤°à¥‡à¤‚à¥¤\n" }]

    - desc: handles Tamil sentence
      data:
        input: { message: "à®‰à®™à¯à®•à®³à¯ˆ à®µà®°à®µà¯‡à®±à¯à®•à®¿à®±à¯‹à®®à¯. à®¤à®¯à®µà¯à®šà¯†à®¯à¯à®¤à¯ à®‰à®™à¯à®•à®³à¯ à®ªà¯†à®¯à®°à¯ˆ à®‰à®³à¯à®³à®¿à®Ÿà®µà¯à®®à¯." }
      expect:
        messages:
          - role: user
            content: [{ text: "à®‰à®™à¯à®•à®³à¯ˆ à®µà®°à®µà¯‡à®±à¯à®•à®¿à®±à¯‹à®®à¯. à®¤à®¯à®µà¯à®šà¯†à®¯à¯à®¤à¯ à®‰à®™à¯à®•à®³à¯ à®ªà¯†à®¯à®°à¯ˆ à®‰à®³à¯à®³à®¿à®Ÿà®µà¯à®®à¯.\n" }]

    - desc: handles Bengali sentence
      data:
        input: { message: "à¦¸à§à¦¬à¦¾à¦—à¦¤à¦®à¥¤ à¦…à¦¨à§à¦—à§à¦°à¦¹ à¦•à¦°à§‡ à¦†à¦ªà¦¨à¦¾à¦° à¦¨à¦¾à¦® à¦²à¦¿à¦–à§à¦¨à¥¤" }
      expect:
        messages:
          - role: user
            content: [{ text: "à¦¸à§à¦¬à¦¾à¦—à¦¤à¦®à¥¤ à¦…à¦¨à§à¦—à§à¦°à¦¹ à¦•à¦°à§‡ à¦†à¦ªà¦¨à¦¾à¦° à¦¨à¦¾à¦® à¦²à¦¿à¦–à§à¦¨à¥¤\n" }]

# Tests emoji support in templates and data.
- name: unicode_emoji
  template: |
    {{greeting}} {{name}} {{emoji}}
  tests:
    - desc: handles basic emoji
      data:
        input: { greeting: "Hello", name: "World", emoji: "ğŸ‘‹" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hello World ğŸ‘‹\n" }]

    - desc: handles emoji sequences (family)
      data:
        input: { greeting: "Hi", name: "Family", emoji: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦" }
      expect:
        messages:
          - role: user
            content: [{ text: "Hi Family ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦\n" }]

    - desc: handles emoji with skin tone modifiers
      data:
        input: { greeting: "Wave", name: "to you", emoji: "ğŸ‘‹ğŸ½" }
      expect:
        messages:
          - role: user
            content: [{ text: "Wave to you ğŸ‘‹ğŸ½\n" }]

    - desc: handles flag emoji
      data:
        input: { greeting: "From", name: "Japan", emoji: "ğŸ‡¯ğŸ‡µ" }
      expect:
        messages:
          - role: user
            content: [{ text: "From Japan ğŸ‡¯ğŸ‡µ\n" }]

    - desc: handles multiple emoji in sequence
      data:
        input: { greeting: "ğŸ‰", name: "Party", emoji: "ğŸŠğŸˆğŸ¥³" }
      expect:
        messages:
          - role: user
            content: [{ text: "ğŸ‰ Party ğŸŠğŸˆğŸ¥³\n" }]

# Tests Unicode in template content itself (not just variables).
- name: unicode_in_template
  template: |
    ä½ å¥½, {{name}}! æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ã€‚
  tests:
    - desc: handles Chinese in template with ASCII variable
      data:
        input: { name: "Alice" }
      expect:
        messages:
          - role: user
            content: [{ text: "ä½ å¥½, Alice! æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ã€‚\n" }]

    - desc: handles Chinese in both template and variable
      data:
        input: { name: "å°æ˜" }
      expect:
        messages:
          - role: user
            content: [{ text: "ä½ å¥½, å°æ˜! æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ã€‚\n" }]

# Tests mixed scripts in a single template.
- name: unicode_mixed_scripts
  template: |
    {{english}} / {{chinese}} / {{japanese}} / {{korean}}
  tests:
    - desc: handles multiple scripts in one template
      data:
        input:
          english: "Hello"
          chinese: "ä½ å¥½"
          japanese: "ã“ã‚“ã«ã¡ã¯"
          korean: "ì•ˆë…•í•˜ì„¸ìš”"
      expect:
        messages:
          - role: user
            content: [{ text: "Hello / ä½ å¥½ / ã“ã‚“ã«ã¡ã¯ / ì•ˆë…•í•˜ì„¸ìš”\n" }]

# Tests special Unicode characters and edge cases.
- name: unicode_special
  template: |
    {{text}}
  tests:
    - desc: handles zero-width characters
      data:
        input: { text: "a\u200Bb\u200Cc" }
      expect:
        messages:
          - role: user
            content: [{ text: "a\u200Bb\u200Cc\n" }]

    - desc: handles combining characters (accents)
      data:
        input: { text: "cafÃ© rÃ©sumÃ© naÃ¯ve" }
      expect:
        messages:
          - role: user
            content: [{ text: "cafÃ© rÃ©sumÃ© naÃ¯ve\n" }]

    - desc: handles mathematical symbols
      data:
        input: { text: "âˆ‘ âˆ âˆ« âˆš âˆ â‰  â‰¤ â‰¥" }
      expect:
        messages:
          - role: user
            content: [{ text: "âˆ‘ âˆ âˆ« âˆš âˆ â‰  â‰¤ â‰¥\n" }]

    - desc: handles currency symbols
      data:
        input: { text: "$ â‚¬ Â£ Â¥ â‚¹ â‚½ â‚¿" }
      expect:
        messages:
          - role: user
            content: [{ text: "$ â‚¬ Â£ Â¥ â‚¹ â‚½ â‚¿\n" }]

    - desc: handles arrows and symbols
      data:
        input: { text: "â† â†’ â†‘ â†“ â†” â‡’ â‡”" }
      expect:
        messages:
          - role: user
            content: [{ text: "â† â†’ â†‘ â†“ â†” â‡’ â‡”\n" }]

# Tests Unicode in nested data structures.
- name: unicode_nested
  template: |
    {{user.name}} says "{{user.greeting}}" in {{user.language}}
  tests:
    - desc: handles Unicode in nested objects
      data:
        input:
          user:
            name: "ç”°ä¸­å¤ªéƒ"
            greeting: "ã“ã‚“ã«ã¡ã¯"
            language: "æ—¥æœ¬èª"
      expect:
        messages:
          - role: user
            content: [{ text: "ç”°ä¸­å¤ªéƒ says \"ã“ã‚“ã«ã¡ã¯\" in æ—¥æœ¬èª\n" }]

# Tests Unicode with iteration helpers.
- name: unicode_iteration
  template: |
    {{#each greetings}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
  tests:
    - desc: handles Unicode in arrays
      data:
        input:
          greetings:
            - "Hello"
            - "ä½ å¥½"
            - "ã“ã‚“ã«ã¡ã¯"
            - "ì•ˆë…•í•˜ì„¸ìš”"
            - "Ù…Ø±Ø­Ø¨Ø§"
      expect:
        messages:
          - role: user
            content: [{ text: "Hello, ä½ å¥½, ã“ã‚“ã«ã¡ã¯, ì•ˆë…•í•˜ì„¸ìš”, Ù…Ø±Ø­Ø¨Ø§\n" }]
