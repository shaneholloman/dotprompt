# Bazel Rules for Dart

This repository contains Bazel rules for building and testing Dart code. It provides a hermetic Dart SDK and supports dependency management via `pubspec.yaml` (using Gazelle).

## Features

- **Hermetic SDK**: Automatically downloads the Dart SDK (3.x) for your platform.
- **Dependency Management**: Integrates with Gazelle to generate `BUILD` files from `pubspec.yaml`.
- **Analyis & Testing**: Rules for running tests, analysis, formatting, and documentation.

## Rules

| Rule | Description | Status |
|------|-------------|--------|
| `dart_library` | Creates library targets | ✅ Done |
| `dart_binary` | Create executable targets | ✅ Done |
| `dart_test` | Run unit tests | ✅ Done |
| `dart_package` | Manage pubspec.yaml dependencies (repository rule) | ✅ Done |
| `dart_analyze` | Run static analysis (`dart analyze`) | ✅ Done |
| `dart_format` | Apply code formatting (`dart format .`) | ✅ Done |
| `dart_format_check` | Verify code formatting (CI) | ✅ Done |
| `dart_doc` | Generate documentation (`dart doc`) | ✅ Done |
| `dart_pub_get` | Resolve dependencies (`dart pub get`) | ✅ Done |
| `dart_pub_publish` | Publish to pub.dev | ✅ Done |

## Setup

1. Add `rules_dart` to your `MODULE.bazel`:

```python
bazel_dep(name = "rules_dart", version = "0.1.0")
```

2. Configure the Dart SDK:

```python
dart = use_extension("@rules_dart//:extensions.bzl", "dart")
dart.configure(version = "3.7.0")
use_repo(dart, "dart_sdk")
```

3. Configure Dependencies (using Gazelle):

```python
dart_deps = use_extension("@rules_dart//:extensions.bzl", "dart_deps")
dart_deps.from_file(lock_file = "//:pubspec.lock")
use_repo(dart_deps, "dart_deps_package_name", ...)
```

## Usage

Generated by Gazelle automatically. Run:

```bash
bazel run //:gazelle
```

Manual usage:

```python
load("@rules_dart//:defs.bzl", "dart_library", "dart_test")

dart_library(
    name = "my_lib",
    srcs = glob(["lib/**/*.dart"]),
    pubspec = "pubspec.yaml",
)

dart_test(
    name = "my_test",
    main = "test/main_test.dart",
    deps = [":my_lib"],
)
```
